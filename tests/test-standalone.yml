---

- hosts: all
  vars:
    apt_cache_valid_time: 3600
  roles:
    - role: shared/apt_sources_list
    - role: ../../mongodb-4.0
      mongodb_bind_ip: "127.0.0.1"
      mongodb_journal_enabled: false
  post_tasks:
    - block:
        - wait_for:
            port: "{{ mongodb_port }}"
        - shell: "grep 'initandlisten' {{ mongodb_logpath }} | tail -n 10"
          register: log
        - debug:
            var: log.stdout_lines
      tags:
        - mongodb
        - test
